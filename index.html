<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PNG Optimizer Pro</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1a1a1a;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      border-radius: 20px;
      background: #1a1a1a;
      box-shadow:
        10px 10px 20px #0f0f0f,
        -10px -10px 20px #242424;
      padding: 25px;
    }
    .header { text-align: center; margin-bottom: 10px; }
    .header h1 { font-size: 2rem; color: #fff; margin-bottom: 5px; }
    .header p { color: #aaa; }

    /* Upload */
    .upload-area {
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      background: #1a1a1a;
      box-shadow:
        inset 6px 6px 12px #0f0f0f,
        inset -6px -6px 12px #242424;
      cursor: pointer;
    }
    .upload-icon { font-size: 2rem; margin-bottom: 10px; }
    .file-input { display: none; }

    /* Controls */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .control-group {
      flex: 1;
      padding: 20px;
      border-radius: 15px;
      background: #1a1a1a;
      box-shadow:
        inset 6px 6px 12px #0f0f0f,
        inset -6px -6px 12px #242424;
      min-width: 280px;
    }
    .control-group h3 { margin-bottom: 10px; color: #fff; font-size: 1rem; }
    label { font-size: 0.9rem; color: #ccc; }

    .neo-input, .neo-slider, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: none;
      border-radius: 12px;
      background: #1a1a1a;
      color: #fff;
      box-shadow:
        inset 4px 4px 8px #0f0f0f,
        inset -4px -4px 8px #242424;
    }
    .neo-input:focus {
      outline: none;
      box-shadow:
        inset 6px 6px 12px #0f0f0f,
        inset -6px -6px 12px #242424,
        0 0 0 2px #fff;
    }
    .slider-value { text-align: center; color: #fff; margin-bottom: 5px; }

    /* Buttons */
    .process-btn, .download-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 15px;
      background: #2a2a2a;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      box-shadow:
        6px 6px 12px #0f0f0f,
        -6px -6px 12px #242424;
      transition: all 0.2s ease;
      margin-top: 10px;
    }
    .process-btn:hover, .download-btn:hover {
      background: #3a3a3a;
    }

    /* Preview */
    .preview-area {
      display: none;
      border-radius: 15px;
      background: #1a1a1a;
      padding: 20px;
      box-shadow:
        inset 6px 6px 12px #0f0f0f,
        inset -6px -6px 12px #242424;
    }
    .preview-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      gap: 30px;
    }
    .preview-item {
      flex: 1;
      min-width: 280px;
      max-width: 350px;
      text-align: center;
      margin-bottom: 20px;
    }
    .preview-item h4 {
      margin-bottom: 15px;
      font-size: 1.1rem;
      color: #fff;
    }
    .preview-img {
      max-width: 100%;
      max-height: 250px;
      border-radius: 10px;
      box-shadow:
        6px 6px 12px #0f0f0f,
        -6px -6px 12px #242424;
      margin-bottom: 15px;
    }
    .preview-info {
      padding: 12px;
      border-radius: 10px;
      background: #1a1a1a;
      box-shadow:
        inset 4px 4px 8px #0f0f0f,
        inset -4px -4px 8px #242424;
      margin-bottom: 10px;
    }
    .info-item { display: flex; justify-content: space-between; margin: 5px 0; }

    /* Progress bar */
    .progress-bar {
      height: 8px;
      border-radius: 6px;
      overflow: hidden;
      display: none;
      background: #1a1a1a;
      box-shadow:
        inset 4px 4px 8px #0f0f0f,
        inset -4px -4px 8px #242424;
      margin: 10px 0;
    }
    .progress-fill {
      height: 100%;
      background: #fff;
      width: 0%;
      transition: width 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>PNG Optimizer Pro</h1>
      <p>Reduce el peso de tus im치genes PNG con control total de resoluci칩n</p>
    </div>

    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">游늬</div>
      <div>Arrastra tus im치genes aqu칤 (puedes subir varias)</div>
      <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>
    </div>

    <div class="controls">
      <div class="control-group">
        <h3>Resoluci칩n</h3>
        <label>Ancho (px)</label>
        <input type="number" id="widthInput" class="neo-input" placeholder="Auto" min="1">
        <label>Alto (px)</label>
        <input type="number" id="heightInput" class="neo-input" placeholder="Auto" min="1">
        <label><input type="checkbox" id="maintainRatio" checked> Mantener proporci칩n</label>
      </div>
      <div class="control-group">
        <h3>Compresi칩n</h3>
        <label>Calidad</label>
        <input type="range" id="qualitySlider" class="neo-slider" min="0.1" max="1" step="0.1" value="0.8">
        <div class="slider-value" id="qualityValue">80%</div>
        <label>Formato</label>
        <select id="formatSelect" class="neo-input">
          <option value="image/png">PNG</option>
          <option value="image/jpeg">JPEG</option>
          <option value="image/webp">WebP</option>
        </select>
      </div>
    </div>

    <button class="process-btn" id="processBtn" disabled>Procesar Im치genes</button>
    <div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill"></div></div>

    <div class="preview-area" id="previewArea">
      <div class="preview-grid" id="previewGrid"></div>
    </div>
  </div>

  <script>
    let originalFiles = [];
    let processedBlobs = [];

    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const processBtn = document.getElementById('processBtn');
    const previewArea = document.getElementById('previewArea');
    const previewGrid = document.getElementById('previewGrid');
    const widthInput = document.getElementById('widthInput');
    const heightInput = document.getElementById('heightInput');
    const maintainRatio = document.getElementById('maintainRatio');
    const qualitySlider = document.getElementById('qualitySlider');
    const qualityValue = document.getElementById('qualityValue');
    const formatSelect = document.getElementById('formatSelect');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');

    uploadArea.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
    processBtn.addEventListener('click', processImages);
    qualitySlider.addEventListener('input', () => {
      qualityValue.textContent = Math.round(qualitySlider.value * 100) + "%";
    });
    widthInput.addEventListener('input', handleDimensionChange);
    heightInput.addEventListener('input', handleDimensionChange);

    function handleFiles(files) {
      originalFiles = Array.from(files);
      previewGrid.innerHTML = ""; // limpiar preview
      processedBlobs = [];
      if (originalFiles.length === 0) return;
      originalFiles.forEach((file, index) => {
        if (!file.type.includes('image/')) return;
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => {
            const card = document.createElement("div");
            card.classList.add("preview-item");
            card.innerHTML = `
              <h4>${file.name}</h4>
              <img src="${e.target.result}" class="preview-img">
              <div class="preview-info">
                <div class="info-item"><span>Tama침o:</span><span>${formatFileSize(file.size)}</span></div>
                <div class="info-item"><span>Dimensiones:</span><span>${img.width}칑${img.height}</span></div>
              </div>
              <div id="optimized-${index}"></div>
            `;
            previewGrid.appendChild(card);
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
      previewArea.style.display = "block";
      processBtn.disabled = false;
    }

    function handleDimensionChange(e) {
      if (!maintainRatio.checked || originalFiles.length === 0) return;
      const img = new Image();
      img.onload = () => {
        const ratio = img.width / img.height;
        if (e.target === widthInput && widthInput.value) {
          heightInput.value = Math.round(widthInput.value / ratio);
        } else if (e.target === heightInput && heightInput.value) {
          widthInput.value = Math.round(heightInput.value * ratio);
        }
      };
      img.src = URL.createObjectURL(originalFiles[0]); // usar la primera imagen como referencia
    }

    async function processImages() {
      if (originalFiles.length === 0) return;
      processedBlobs = [];
      progressBar.style.display = "block";
      progressFill.style.width = "0%";

      let completed = 0;
      originalFiles.forEach((file, index) => {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        const img = new Image();
        img.onload = () => {
          const newW = parseInt(widthInput.value) || img.width;
          const newH = parseInt(heightInput.value) || img.height;
          canvas.width = newW; canvas.height = newH;
          ctx.drawImage(img, 0, 0, newW, newH);
          canvas.toBlob((blob) => {
            processedBlobs[index] = blob;
            const div = document.getElementById(`optimized-${index}`);
            div.innerHTML = `
              <h4>Optimizada</h4>
              <img src="${URL.createObjectURL(blob)}" class="preview-img">
              <div class="preview-info">
                <div class="info-item"><span>Tama침o:</span><span>${formatFileSize(blob.size)}</span></div>
                <div class="info-item"><span>Dimensiones:</span><span>${newW}칑${newH}</span></div>
                <div class="info-item"><span>Reducci칩n:</span><span>${(((file.size - blob.size) / file.size * 100).toFixed(1))}%</span></div>
              </div>
              <button class="download-btn" onclick="downloadImage(${index})">Descargar</button>
            `;
            completed++;
            progressFill.style.width = `${(completed / originalFiles.length) * 100}%`;
            if (completed === originalFiles.length) {
              setTimeout(() => { progressBar.style.display = "none"; }, 500);
            }
          }, formatSelect.value, parseFloat(qualitySlider.value));
        };
        img.src = URL.createObjectURL(file);
      });
    }

    function downloadImage(index) {
      const blob = processedBlobs[index];
      if (!blob) return;
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      const baseName = originalFiles[index].name.split('.').slice(0, -1).join('.');
      const ext = formatSelect.value.split('/')[1];
      link.download = `${baseName}.${ext}`;
      link.click();
    }

    function formatFileSize(bytes) {
      const sizes = ["Bytes","KB","MB"];
      if (bytes === 0) return "0 Bytes";
      const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
      return (bytes / Math.pow(1024,i)).toFixed(2) + " " + sizes[i];
    }
  </script>
</body>
</html>
